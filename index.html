<!DOCTYPE html> <!-- å£°æ˜æ–‡æ¡£ç±»å‹ä¸ºHTML -->
<html lang="zh-CN"> <!-- è®¾ç½®é¡µé¢è¯­è¨€ä¸ºä¸­æ–‡ -->
<head> <!-- é¡µé¢å¤´éƒ¨ä¿¡æ¯ -->
    <meta charset="UTF-8"> <!-- è®¾ç½®å­—ç¬¦ç¼–ç ä¸ºUTF-8 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> <!-- ç§»åŠ¨ç«¯é€‚é… -->
    <title>åœ°é“æ¨¡æ‹Ÿå™¨ - Subway Simulator</title> <!-- ç½‘é¡µæ ‡é¢˜ -->
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root { /* å®šä¹‰å…¨å±€CSSå˜é‡ */
            --platform-gray: #3a3a3a; /* ç«™å°ç°è‰² */
            --safety-yellow: #ffc107; /* å®‰å…¨é»„ */
            --glass-blue: rgba(135, 206, 235, 0.22); /* ç»ç’ƒè“ */
            --glass-border: rgba(255, 255, 255, 0.25); /* ç»ç’ƒè¾¹æ¡† */
            --line-color: #009944; /* çº¿è·¯ä¸»è‰² */
            --train-silver: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 30%, #a0a0a0 60%, #d0d0d0 100%); /* åˆ—è½¦é“¶è‰²æ¸å˜ */
        }

        body { /* é¡µé¢ä¸»ä½“æ ·å¼ */
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif; /* å­—ä½“ */
            background: #0a0a15; /* èƒŒæ™¯è‰² */
            min-height: 100vh; /* æœ€å°é«˜åº¦ */
            overflow: hidden; /* éšè—æ»šåŠ¨æ¡ */
            display: flex; /* å¼¹æ€§å¸ƒå±€ */
            flex-direction: column; /* å‚ç›´æ’åˆ— */
            align-items: center; /* å±…ä¸­ */
        }

        /* é¡¶éƒ¨æ ‡é¢˜ */
        .main-title {
            position: fixed; /* å›ºå®šå®šä½ */
            top: 8px; /* è·é¡¶éƒ¨8px */
            left: 50%; /* å±…ä¸­ */
            transform: translateX(-50%); /* æ°´å¹³å±…ä¸­ */
            color: white; /* ç™½è‰²å­—ä½“ */
            font-size: 20px; /* å­—å· */
            font-weight: bold; /* åŠ ç²— */
            text-shadow: 0 0 15px rgba(135, 206, 235, 0.6); /* å‘å…‰é˜´å½± */
            z-index: 500; /* å±‚çº§é«˜ */
            letter-spacing: 3px; /* å­—é—´è· */
        }

        /* çº¿è·¯å›¾åŒºåŸŸ */
        .route-display {
            position: fixed; /* å›ºå®šå®šä½ */
            top: 45px; /* è·é¡¶éƒ¨45px */
            left: 50%; /* å±…ä¸­ */
            transform: translateX(-50%); /* æ°´å¹³å±…ä¸­ */
            width: 95%; /* å®½åº¦95% */
            max-width: 550px; /* æœ€å¤§å®½åº¦550px */
            background: linear-gradient(180deg, #0f1a2e 0%, #1a2a4a 100%); /* æ¸å˜èƒŒæ™¯ */
            border: 1px solid rgba(255,255,255,0.1); /* è¾¹æ¡† */
            border-radius: 8px; /* åœ†è§’ */
            z-index: 400; /* å±‚çº§ */
            overflow: hidden; /* éšè—æº¢å‡º */
        }

        .route-header { /* çº¿è·¯å›¾å¤´éƒ¨ */
            display: flex; /* å¼¹æ€§å¸ƒå±€ */
            justify-content: space-between; /* ä¸¤ç«¯å¯¹é½ */
            align-items: center; /* å‚ç›´å±…ä¸­ */
            padding: 6px 12px; /* å†…è¾¹è· */
            background: rgba(0, 0, 0, 0.3); /* åŠé€æ˜èƒŒæ™¯ */
            border-bottom: 2px solid var(--line-color); /* åº•éƒ¨çº¿æ¡ */
        }

        .route-direction { font-size: 11px; color: #aaa; flex: 1; } /* æ–¹å‘æ–‡å­—æ ·å¼ */

        .route-direction.left { text-align: left; } /* å·¦ä¾§å¯¹é½ */
        .route-direction.right { text-align: right; } /* å³ä¾§å¯¹é½ */

        .route-center { display: flex; align-items: center; gap: 10px; } /* ä¸­é—´åŒºåŸŸ */

        .line-badge {
            background: var(--line-color); /* çº¿è·¯è‰²èƒŒæ™¯ */
            color: white; /* ç™½è‰²å­—ä½“ */
            padding: 3px 10px; /* å†…è¾¹è· */
            border-radius: 3px; /* åœ†è§’ */
            font-weight: bold; /* åŠ ç²— */
            font-size: 13px; /* å­—å· */
        }

        .current-station { color: #ffc107; font-size: 14px; font-weight: bold; } /* å½“å‰ç«™ç‚¹æ ·å¼ */

        /* å¸¦çŠ¶çº¿è·¯å›¾ */
        .route-strip {
            display: flex; /* å¼¹æ€§å¸ƒå±€ */
            justify-content: center; /* å±…ä¸­ */
            align-items: center; /* å‚ç›´å±…ä¸­ */
            padding: 10px 15px; /* å†…è¾¹è· */
            gap: 0; /* é—´è·ä¸º0 */
        }

        .station {
            display: flex; /* å¼¹æ€§å¸ƒå±€ */
            flex-direction: column; /* å‚ç›´æ’åˆ— */
            align-items: center; /* å±…ä¸­ */
            position: relative; /* ç›¸å¯¹å®šä½ */
        }

        .station-dot {
            width: 10px; height: 10px; border-radius: 50%; background: #555; border: 2px solid #777; position: relative; z-index: 2;
        } /* ç«™ç‚¹åœ†ç‚¹ */

        .station.current .station-dot {
            background: var(--line-color); /* å½“å‰ç«™ç‚¹é«˜äº® */
            border-color: #00ff66; /* ç»¿è‰²è¾¹æ¡† */
            box-shadow: 0 0 10px var(--line-color); /* å‘å…‰æ•ˆæœ */
            animation: pulseDot 1.5s infinite; /* å‘¼å¸åŠ¨ç”» */
        }

        @keyframes pulseDot {
            0%, 100% { transform: scale(1); } /* åˆå§‹/ç»“æŸç¼©æ”¾1å€ */
            50% { transform: scale(1.25); } /* ä¸­é—´æ”¾å¤§1.25å€ */
        }

        .station-name { color: #888; font-size: 11px; margin-top: 4px; white-space: nowrap; } /* ç«™ç‚¹åç§°æ ·å¼ */

        .station.current .station-name { color: #ffc107; font-weight: bold; } /* å½“å‰ç«™ç‚¹åç§°é«˜äº® */

        .station-line { width: 55px; height: 3px; background: #555; margin-top: -16px; } /* ç«™ç‚¹é—´è¿çº¿ */

        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-indicator {
            position: fixed; /* å›ºå®šå®šä½ */
            top: 155px; /* è·é¡¶éƒ¨155px */
            left: 50%; /* å±…ä¸­ */
            transform: translateX(-50%); /* æ°´å¹³å±…ä¸­ */
            padding: 5px 16px; /* å†…è¾¹è· */
            background: rgba(0, 0, 0, 0.7); /* åŠé€æ˜èƒŒæ™¯ */
            border-radius: 15px; /* åœ†è§’ */
            color: white; /* ç™½è‰²å­—ä½“ */
            font-size: 12px; /* å­—å· */
            font-weight: bold; /* åŠ ç²— */
            z-index: 300; /* å±‚çº§ */
            border: 1px solid rgba(255, 255, 255, 0.2); /* è¾¹æ¡† */
            transition: all 0.3s; /* è¿‡æ¸¡åŠ¨ç”» */
        }

        .status-indicator.arriving { border-color: #0099ff; color: #66ccff; } /* è¿›ç«™çŠ¶æ€ */
        .status-indicator.boarding { border-color: #00ff66; color: #66ff99; } /* ä¸Šä¸‹å®¢çŠ¶æ€ */
        .status-indicator.departing { border-color: #ff6600; color: #ffaa66; } /* ç¦»ç«™çŠ¶æ€ */

        /* æ¸¸æˆå®¹å™¨ - ç´§è´´åœ¨çº¿è·¯å›¾ä¸‹æ–¹ */
        .game-container {
            position: fixed; /* å›ºå®šå®šä½ */
            top: 185px; /* è·é¡¶éƒ¨185px */
            left: 50%; /* å±…ä¸­ */
            transform: translateX(-50%); /* æ°´å¹³å±…ä¸­ */
            width: 95%; /* å®½åº¦95% */
            max-width: 900px; /* æœ€å¤§å®½åº¦900px */
            height: calc(100vh - 280px); /* é«˜åº¦è‡ªé€‚åº” */
            perspective: 1500px; /* 3Dè§†è§’è·ç¦» */
            perspective-origin: 50% 50%; /* è§†è§’ä¸­å¿ƒ */
            overflow: hidden; /* éšè—æº¢å‡º */
        }

        /* 3Dåœºæ™¯ */
        .scene {
            width: 100%; height: 100%; position: relative; transform-style: preserve-3d;
            top: 10px;
        } /* 3Dåœºæ™¯å®¹å™¨ */

        /* éš§é“èƒŒæ™¯ - ä¸å±è”½é—¨åŒºåŸŸå®Œå…¨ä¸€è‡´ */
        .tunnel {
            position: absolute; /* ç»å¯¹å®šä½ */
            top: 0; /* é¡¶éƒ¨å¯¹é½ */
            left: 50%; /* å±…ä¸­ */
            transform: translateX(-50%) translateZ(-400px); /* 3Dåç§» */
            background: linear-gradient(180deg, #050510 0%, #0a0a1a 100%); /* æ¸å˜èƒŒæ™¯ */
            overflow: hidden; /* éšè—æº¢å‡º */
            width: 100vw; /* é»˜è®¤å®½åº¦ï¼Œé˜²æ­¢åˆå§‹æŠ–åŠ¨ */
            max-width: 570px; /* æ¨ªå±æœ€å¤§å®½åº¦ä¸psd-systemä¸€è‡´ */
        }

        /* ç«–å±éš§é“ */
        @media (orientation: portrait) {
            .tunnel { width: 410px; max-width: 410px; height: 55%; } /* ç«–å±å®½åº¦ä¸psd-systemä¸€è‡´ */
        }

        /* æ¨ªå±éš§é“ */
        @media (orientation: landscape) {
            .tunnel { width: 570px; max-width: 570px; height: 55%; } /* æ¨ªå±å®½åº¦ä¸psd-systemä¸€è‡´ */
        }

        .tunnel-lights { position: absolute; width: 100%; height: 100%; } /* éš§é“ç¯å…‰å®¹å™¨ */

        .tunnel-light {
            position: absolute; width: 4px; height: 4px; background: #fff; border-radius: 50%; box-shadow: 0 0 10px #fff, 0 0 20px rgba(135, 206, 235, 0.4);
        } /* éš§é“ç¯å…‰ç‚¹ */

        /* åˆ—è½¦ */
        .train {
            position: absolute; /* ç»å¯¹å®šä½ */
            top: 0; /* é¡¶éƒ¨å¯¹é½ */
            height: 55%; /* é«˜åº¦55% */
            transform: translateZ(-200px); /* 3Dåç§» */
            transform-style: preserve-3d; /* ä¿æŒ3D */
        }

        /* ç«–å±åˆ—è½¦ */
        @media (orientation: portrait) {
            .train { width: 410px; } /* ç«–å±å®½åº¦ï¼ŒåŸæ¥205pxï¼Œç°ä¸ºä¸¤å€ */
        }

        /* æ¨ªå±åˆ—è½¦ */
        @media (orientation: landscape) {
            .train { width: 570px; } /* æ¨ªå±å®½åº¦ */
        }

        /* å‘å·¦è¡Œé©¶ */
        .train.dir-left {
            left: calc(50% + 130vw); /* åˆå§‹åœ¨å³ä¾§å±å¹•å¤– */
            transition: left 3s cubic-bezier(0.4, 0, 0.2, 1); /* åŠ¨ç”» */
            /* ä¿®å¤ç¦»ç«™åŠ¨ç”»èµ·å§‹ä½ç½® */
            transform: translateZ(-200px) translateX(-50%);
        }

        .train.dir-left.arrived {
            left: 50%; /* åˆ°è¾¾ä¸­é—´ */
            transform: translateZ(-200px) translateX(-50%); /* å±…ä¸­ */
        }

        .train.dir-left.departed { left: calc(50% - 130vw); } /* ç¦»å¼€åˆ°å·¦ä¾§å±å¹•å¤– */

        /* å‘å³è¡Œé©¶ */
        .train.dir-right {
            left: calc(50% - 130vw); /* åˆå§‹åœ¨å·¦ä¾§å±å¹•å¤– */
            transition: left 3s cubic-bezier(0.4, 0, 0.2, 1); /* åŠ¨ç”» */
            /* ä¿®å¤ç¦»ç«™åŠ¨ç”»èµ·å§‹ä½ç½® */
            transform: translateZ(-200px) translateX(-50%);
        }

        .train.dir-right.arrived {
            left: 50%; /* åˆ°è¾¾ä¸­é—´ */
            transform: translateZ(-200px) translateX(-50%); /* å±…ä¸­ */
        }

        .train.dir-right.departed { left: calc(50% + 130vw); } /* ç¦»å¼€åˆ°å³ä¾§å±å¹•å¤– */

        .train-body { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; } /* åˆ—è½¦ä¸»ä½“ */

        .train-side {
            position: absolute; width: 100%; height: 100%; background: var(--train-silver); border-radius: 8px 8px 0 0;
            box-shadow: inset 0 2px 10px rgba(255,255,255,0.4), inset 0 -2px 10px rgba(0,0,0,0.3), 0 5px 15px rgba(0,0,0,0.5);
            overflow: hidden;
        } /* åˆ—è½¦ä¾§é¢ */

        .train-stripe {
            position: absolute; top: 45%; left: 0; width: 100%; height: 4%;
            background: linear-gradient(90deg, var(--line-color) 0%, #00cc66 50%, var(--line-color) 100%);
        } /* åˆ—è½¦è…°çº¿ */

        .train-doors {
            position: absolute; width: 100%; height: 90%; top: 5%; display: flex; justify-content: center; align-items: center;
        } /* åˆ—è½¦é—¨åŒºåŸŸ */

        /* ç«–å± - ä¸€ä¸ªé—¨ï¼Œå®½åº¦128px */
        @media (orientation: portrait) {
            .train-door-unit:nth-child(2) { display: none; } /* åªæ˜¾ç¤ºä¸€ä¸ªé—¨ */
            .train-doors { gap: 0; } /* æ— é—´è· */
        }

        /* æ¨ªå± - ä¸¤ä¸ªé—¨ï¼Œæ¯ä¸ª128pxï¼Œé—´è·200px */
        @media (orientation: landscape) {
            .train-doors { gap: 150px; } /* ä¸¤é—¨é—´è· */
        }

        .train-door-unit {
            width: 128px; height: 90%; position: relative; background: #222; border: 2px solid #444; border-radius: 2px;
        } /* åˆ—è½¦é—¨å•å…ƒ */

        .train-door-container {
            width: 100%; height: 100%; display: flex;
        } /* åˆ—è½¦é—¨å®¹å™¨ */

        .train-door {
            flex: 1; height: 100%; background: linear-gradient(90deg, #1a1a2e 0%, #2a2a3e 50%, #1a1a2e 100%);
            border: 1px solid #333; position: relative; transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1);
        } /* åˆ—è½¦é—¨ */

        .train-door.left.open { transform: translateX(-90%); } /* å·¦é—¨å¼€é—¨åŠ¨ç”» */

        .train-door.right.open { transform: translateX(90%); } /* å³é—¨å¼€é—¨åŠ¨ç”» */

        /* å±è”½é—¨ç³»ç»Ÿ */
        .psd-system {
            position: absolute; top: 0; left: 50%; transform: translateX(-50%) translateZ(50px); height: 55%;
            display: flex; justify-content: center; align-items: flex-end;
            z-index: 2;
        } /* å±è”½é—¨ç³»ç»Ÿå®¹å™¨ */

        /* ç«–å±å±è”½é—¨ */
        @media (orientation: portrait) {
            .psd-system { width: 410px; } /* ç«–å±å®½åº¦ï¼ŒåŸæ¥205pxï¼Œç°ä¸ºä¸¤å€ */
            .psd-mid-glass,
            .psd-door-area-2 { display: none !important; } /* éšè—ç¬¬äºŒç»„é—¨ */
            .psd-door-area-1 { margin: 0 auto; } /* å±…ä¸­æ˜¾ç¤º */
            .psd-side-glass, .psd-mid-glass { flex: 2; } /* ç«–å±ä¸‹ç»ç’ƒå®½åº¦å˜ä¸ºä¸¤å€ */
        }

        /* æ¨ªå±å±è”½é—¨ */
        @media (orientation: landscape) {
            .psd-system { width: 570px; } /* æ¨ªå±å®½åº¦ */
            .psd-mid-glass,
            .psd-door-area:nth-child(3) { display: flex !important; } /* æ˜¾ç¤ºä¸­é—´é—¨ */
        }

        .psd-whole {
            width: 100%; height: 100%; display: flex; background: rgba(200, 220, 240, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.12); border-radius: 2px;
        } /* å±è”½é—¨æ•´ä½“ */

        .psd-side-glass {
            flex: 1; height: 100%; background: var(--glass-blue); border-left: 1px solid var(--glass-border); border-right: 1px solid var(--glass-border);
        } /* å±è”½é—¨ä¾§ç»ç’ƒ */

        .psd-mid-glass {
            display: none; flex: 1; height: 100%; background: var(--glass-blue); border-left: 1px solid var(--glass-border); border-right: 1px solid var(--glass-border);
        } /* å±è”½é—¨ä¸­é—´ç»ç’ƒ */

        .psd-door-area {
            flex: 0 0 128px; height: 100%; display: flex; background: rgba(0, 0, 0, 0.1);
        } /* å±è”½é—¨é—¨åŒº */

        .psd-door {
            flex: 1; height: 100%;
            background: linear-gradient(90deg, rgba(180, 200, 220, 0.45) 0%, rgba(200, 220, 240, 0.55) 50%, rgba(180, 200, 220, 0.45) 100%);
            border: 1px solid rgba(255, 255, 255, 0.35); position: relative; transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1);
        } /* å±è”½é—¨é—¨ä½“ */

        .psd-door::after {
            content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 30%; height: 1px; background: rgba(255, 255, 255, 0.4);
        } /* å±è”½é—¨ä¸­çº¿ */

        .psd-door.left.open { transform: translateX(-90%); } /* å±è”½é—¨å·¦é—¨å¼€é—¨åŠ¨ç”» */

        .psd-door.right.open { transform: translateX(90%); } /* å±è”½é—¨å³é—¨å¼€é—¨åŠ¨ç”» */

        /* ç«™å° */
        .platform {
            position: absolute; top: 55%; left: 0; width: 100%; height: 15%;
            background: linear-gradient(180deg, #3a3a3a 0%, #2a2a2a 100%); transform: translateZ(100px);
            z-index: 1; 
        } /* ç«™å°åŒºåŸŸ */

        .platform-floor { width: 100%; height: 100%; background: linear-gradient(0deg, #2a2a2a 0%, #3a3a3a 100%); } /* ç«™å°åœ°é¢ */

        .safety-line {
            position: absolute; top: 8px; left: 0; width: 100%; height: 4px;
            background: repeating-linear-gradient(90deg, var(--safety-yellow) 0px, var(--safety-yellow) 15px, transparent 15px, transparent 22px);
            box-shadow: 0 0 5px rgba(255, 193, 7, 0.3);
        } /* ç«™å°å®‰å…¨çº¿ */

        /* é€Ÿåº¦çº¿ */
        .speed-lines {
            position: absolute; left: 50%; top: 0; width: 100%; height: 55%; pointer-events: none; opacity: 0; transition: opacity 0.3s; z-index: 10;
            transform: translateX(-50%);
        } /* é€Ÿåº¦çº¿å®¹å™¨ */

        .speed-lines.active { opacity: 1; } /* æ¿€æ´»é€Ÿåº¦çº¿ */

        .speed-line {
            position: absolute; height: 2px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); animation: speedLine 0.3s linear infinite;
        } /* å•æ¡é€Ÿåº¦çº¿ */

        @keyframes speedLine {
            0% { transform: translateX(100vw); } /* ä»å³åˆ°å·¦ */
            100% { transform: translateX(-100vw); }
        }

        /* æ§åˆ¶é¢æ¿ */
        .controls {
            position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); display: flex; flex-wrap: wrap; justify-content: center; gap: 6px;
            padding: 10px 15px; background: rgba(0, 0, 0, 0.85); border-radius: 10px; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); z-index: 200; max-width: 98%;
        } /* æ§åˆ¶æŒ‰é’®åŒºåŸŸ */

        .control-btn {
            padding: 8px 14px; font-size: 12px; font-weight: bold; border: none; border-radius: 5px; cursor: pointer; transition: all 0.25s;
            text-transform: uppercase; letter-spacing: 0.5px; color: white;
        } /* æ§åˆ¶æŒ‰é’®æ ·å¼ */

        .control-btn:hover:not(:disabled) { transform: translateY(-2px); } /* æŒ‰é’®æ‚¬åœæ•ˆæœ */

        .control-btn:disabled { opacity: 0.4; cursor: not-allowed; } /* ç¦ç”¨æŒ‰é’®æ ·å¼ */

        .btn-arrive { background: linear-gradient(135deg, #0099ff 0%, #0066cc 100%); } /* è¿›ç«™æŒ‰é’® */
        .btn-arrive:hover:not(:disabled) { box-shadow: 0 3px 10px rgba(0, 153, 255, 0.4); }

        .btn-open { background: linear-gradient(135deg, #00cc66 0%, #009944 100%); } /* å¼€é—¨æŒ‰é’® */
        .btn-open:hover:not(:disabled) { box-shadow: 0 3px 10px rgba(0, 204, 102, 0.4); }

        .btn-close { background: linear-gradient(135deg, #ff6633 0%, #cc4422 100%); } /* å…³é—¨æŒ‰é’® */
        .btn-close:hover:not(:disabled) { box-shadow: 0 3px 10px rgba(255, 102, 51, 0.4); }

        .btn-depart { background: linear-gradient(135deg, #9966ff 0%, #6633cc 100%); } /* ç¦»ç«™æŒ‰é’® */
        .btn-depart:hover:not(:disabled) { box-shadow: 0 3px 10px rgba(153, 102, 255, 0.4); }

        .btn-auto { background: linear-gradient(135deg, #ffcc00 0%, #ff9900 100%); color: #333; } /* è‡ªåŠ¨æŒ‰é’® */
        .btn-auto:hover:not(:disabled) { box-shadow: 0 3px 10px rgba(255, 204, 0, 0.4); }
        .btn-auto.active { animation: autoPulse 1.2s infinite; }

        .btn-direction {
            background: linear-gradient(135deg, #666 0%, #444 100%); border: 2px solid transparent;
        }
        .btn-direction:hover:not(:disabled) {
            box-shadow: 0 3px 10px rgba(100, 100, 100, 0.4);
        }
        .btn-direction.active {
            border-color: #00ccff;
            background: linear-gradient(135deg, #0088cc 0%, #0066aa 100%);
        }

        @keyframes autoPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 204, 0, 0.5); }
            50% { box-shadow: 0 0 0 8px rgba(255, 204, 0, 0); }
        }

        /* å°å±å¹•é€‚é… */
        @media (max-height: 600px) {
            .game-container {
                width: 98%;
                max-width: 1200px;
                height: calc(110vh - 210px);
                top: 135px;
            }
            .main-title {
                font-size: 16px;
            }
            .route-display {
                top: 40px;
            }
            .status-indicator {
                top: 145px;
            }
        }
    </style> <!-- æ ·å¼ç»“æŸ -->
</head>
<body>
    <div class="main-title">åœ°é“æ¨¡æ‹Ÿå™¨</div> <!-- é¡¶éƒ¨æ ‡é¢˜ -->

    <!-- çº¿è·¯å›¾åŒºåŸŸ -->
    <div class="route-display"> <!-- çº¿è·¯å›¾ä¸»å®¹å™¨ -->
        <div class="route-header"> <!-- çº¿è·¯å›¾å¤´éƒ¨ -->
            <div class="route-direction left">â† å¸‚æ°‘ä¸­å¿ƒæ–¹å‘</div> <!-- å·¦ä¾§æ–¹å‘ -->
            <div class="route-center"> <!-- ä¸­é—´å½“å‰ç«™ç‚¹ -->
                <span class="line-badge">9å·çº¿</span> <!-- çº¿è·¯å¾½ç«  -->
                <span class="current-station">æ–‡åŒ–ä¸­å¿ƒ</span> <!-- å½“å‰ç«™ç‚¹åç§° -->
            </div>
            <div class="route-direction right">å•†ä¸šè¡—æ–¹å‘ â†’</div> <!-- å³ä¾§æ–¹å‘ -->
        </div>
        <div class="route-strip" id="routeStrip"></div> <!-- çº¿è·¯å¸¦çŠ¶å›¾ -->
    </div>

    <div class="status-indicator" id="statusText">å‡†å¤‡å°±ç»ª</div> <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->

    <div class="game-container"> <!-- æ¸¸æˆä¸»å®¹å™¨ -->
        <div class="scene"> <!-- 3Dåœºæ™¯ -->
            <div class="speed-lines" id="speedLines"></div> <!-- é€Ÿåº¦çº¿ç‰¹æ•ˆ -->

            <!-- éš§é“ -->
            <div class="tunnel"> <!-- éš§é“èƒŒæ™¯ -->
                <div class="tunnel-lights" id="tunnelLights"></div> <!-- éš§é“ç¯å…‰ -->
            </div>

            <!-- åˆ—è½¦ -->
            <div class="train dir-left" id="train"> <!-- åˆ—è½¦ä¸»ä½“ -->
                <div class="train-body"> <!-- åˆ—è½¦è½¦èº« -->
                    <div class="train-side"> <!-- åˆ—è½¦ä¾§é¢ -->
                        <div class="train-stripe"></div> <!-- åˆ—è½¦è…°çº¿ -->
                        <div class="train-doors"> <!-- åˆ—è½¦é—¨åŒºåŸŸ -->
                            <div class="train-door-unit"> <!-- ç¬¬ä¸€ä¸ªé—¨å•å…ƒ -->
                                <div class="train-door-container"> <!-- é—¨å®¹å™¨ -->
                                    <div class="train-door left" id="tDoor1L"></div> <!-- å·¦é—¨ -->
                                    <div class="train-door right" id="tDoor1R"></div> <!-- å³é—¨ -->
                                </div>
                            </div>
                            <div class="train-door-unit"> <!-- ç¬¬äºŒä¸ªé—¨å•å…ƒ -->
                                <div class="train-door-container"> <!-- é—¨å®¹å™¨ -->
                                    <div class="train-door left" id="tDoor2L"></div> <!-- å·¦é—¨ -->
                                    <div class="train-door right" id="tDoor2R"></div> <!-- å³é—¨ -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å±è”½é—¨ -->
            <div class="psd-system"> <!-- å±è”½é—¨ç³»ç»Ÿ -->
                <div class="psd-whole"> <!-- å±è”½é—¨æ•´ä½“ -->
                    <div class="psd-side-glass"></div> <!-- å·¦ä¾§ç»ç’ƒ -->
                    <div class="psd-door-area psd-door-area-1"> <!-- ç¬¬ä¸€ç»„é—¨ -->
                        <div class="psd-door left" id="pDoor1L"></div> <!-- å·¦é—¨ -->
                        <div class="psd-door right" id="pDoor1R"></div> <!-- å³é—¨ -->
                    </div>
                    <div class="psd-mid-glass"></div> <!-- ä¸­é—´ç»ç’ƒ -->
                    <div class="psd-door-area psd-door-area-2"> <!-- ç¬¬äºŒç»„é—¨ -->
                        <div class="psd-door left" id="pDoor2L"></div> <!-- å·¦é—¨ -->
                        <div class="psd-door right" id="pDoor2R"></div> <!-- å³é—¨ -->
                    </div>
                    <div class="psd-side-glass"></div> <!-- å³ä¾§ç»ç’ƒ -->
                </div>
            </div>

            <!-- ç«™å° -->
            <div class="platform"> <!-- ç«™å°åŒºåŸŸ -->
                <div class="platform-floor"> <!-- ç«™å°åœ°é¢ -->
                    <div class="safety-line"></div> <!-- å®‰å…¨çº¿ -->
                </div>
            </div>
        </div>
    </div>

    <div class="controls"> <!-- æ§åˆ¶æŒ‰é’®åŒºåŸŸ -->
        <button class="control-btn btn-direction active" id="btnLeft">å‘å·¦è¡Œé©¶</button> <!-- å‘å·¦æŒ‰é’® -->
        <button class="control-btn btn-direction" id="btnRight">å‘å³è¡Œé©¶</button> <!-- å‘å³æŒ‰é’® -->
        <button class="control-btn btn-arrive" id="btnArrive">è¿›ç«™</button> <!-- è¿›ç«™æŒ‰é’® -->
        <button class="control-btn btn-open" id="btnOpen" disabled>å¼€é—¨</button> <!-- å¼€é—¨æŒ‰é’® -->
        <button class="control-btn btn-close" id="btnClose" disabled>å…³é—¨</button> <!-- å…³é—¨æŒ‰é’® -->
        <button class="control-btn btn-depart" id="btnDepart" disabled>ç¦»ç«™</button> <!-- ç¦»ç«™æŒ‰é’® -->
        <button class="control-btn btn-auto" id="btnAuto">è‡ªåŠ¨å¾ªç¯</button> <!-- è‡ªåŠ¨æŒ‰é’® -->
    </div>


    <script>
        // ==================== éŸ³é¢‘ ====================
        // éŸ³é¢‘åˆå§‹åŒ–æ ‡å¿—
        let audioUnlocked = false;
        let audioLoadedCount = 0;
        const totalAudios = 5;

        // ä½¿ç”¨ç»å¯¹è·¯å¾„å¹¶æ·»åŠ é¢„åŠ è½½
        const dingdong = new Audio('./dingdong.mp3');
        dingdong.preload = 'auto';
        dingdong.load(); // å¼ºåˆ¶åŠ è½½

        const announceLeft = new Audio('./announce_left.mp3');
        announceLeft.preload = 'auto';
        announceLeft.load();

        const announceRight = new Audio('./announce_right.mp3');
        announceRight.preload = 'auto';
        announceRight.load();

        const doorOpenSound = new Audio('./door_open.mp3');
        doorOpenSound.preload = 'auto';
        doorOpenSound.load();

        const doorCloseSound = new Audio('./door_close.mp3');
        doorCloseSound.preload = 'auto';
        doorCloseSound.load();

        // éŸ³é¢‘åŠ è½½çŠ¶æ€è·Ÿè¸ª
        const audioLoadStatus = {
            dingdong: false,
            announceLeft: false,
            announceRight: false,
            doorOpen: false,
            doorClose: false
        };

        // éŸ³é¢‘åŠ è½½é”™è¯¯å¤„ç†
        dingdong.addEventListener('error', (e) => console.error('å®å’šéŸ³åŠ è½½å¤±è´¥:', e));
        dingdong.addEventListener('canplaythrough', () => {
            audioLoadStatus.dingdong = true;
            audioLoadedCount++;
            console.log('å®å’šéŸ³åŠ è½½æˆåŠŸ');
        });

        announceLeft.addEventListener('error', (e) => console.error('å·¦æŠ¥ç«™éŸ³åŠ è½½å¤±è´¥:', e));
        announceLeft.addEventListener('canplaythrough', () => {
            audioLoadStatus.announceLeft = true;
            audioLoadedCount++;
            console.log('å·¦æŠ¥ç«™éŸ³åŠ è½½æˆåŠŸ');
        });

        announceRight.addEventListener('error', (e) => console.error('å³æŠ¥ç«™éŸ³åŠ è½½å¤±è´¥:', e));
        announceRight.addEventListener('canplaythrough', () => {
            audioLoadStatus.announceRight = true;
            audioLoadedCount++;
            console.log('å³æŠ¥ç«™éŸ³åŠ è½½æˆåŠŸ');
        });

        doorOpenSound.addEventListener('error', (e) => console.error('å¼€é—¨éŸ³åŠ è½½å¤±è´¥:', e));
        doorOpenSound.addEventListener('canplaythrough', () => {
            audioLoadStatus.doorOpen = true;
            audioLoadedCount++;
            console.log('å¼€é—¨éŸ³åŠ è½½æˆåŠŸ');
        });

        doorCloseSound.addEventListener('error', (e) => console.error('å…³é—¨éŸ³åŠ è½½å¤±è´¥:', e));
        doorCloseSound.addEventListener('canplaythrough', () => {
            audioLoadStatus.doorClose = true;
            audioLoadedCount++;
            console.log('å…³é—¨éŸ³åŠ è½½æˆåŠŸ');
        });

        // è§£é”ç§»åŠ¨ç«¯éŸ³é¢‘æ’­æ”¾
        function unlockAudio() {
            if (audioUnlocked) return;

            const allAudios = [dingdong, announceLeft, announceRight, doorOpenSound, doorCloseSound];

            // å°è¯•æ’­æ”¾å¹¶ç«‹å³æš‚åœæ¥è§£é”éŸ³é¢‘
            allAudios.forEach(audio => {
                // è®¾ç½®éŸ³é‡ä¸º0æ¥é™é»˜æ’­æ”¾
                const originalVolume = audio.volume;
                audio.volume = 0;

                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        audio.pause();
                        audio.currentTime = 0;
                        audio.volume = originalVolume;
                    }).catch(() => {
                        audio.volume = originalVolume;
                    });
                }
            });

            audioUnlocked = true;
            console.log('éŸ³é¢‘å·²è§£é”');

            // çŸ­æš‚æ˜¾ç¤ºæç¤º
            const originalStatus = statusText.textContent;
            setStatus('ğŸ”Š éŸ³é¢‘å·²å¯ç”¨', '');
            setTimeout(() => {
                if (state === 'ready' || state === 'departed') {
                    setStatus('å‡†å¤‡å°±ç»ª', '');
                }
            }, 1500);
        }

        function playDingdong() { // æ’­æ”¾å®å’šéŸ³
            if (!audioUnlocked) {
                console.warn('éŸ³é¢‘æœªè§£é”ï¼Œå°è¯•è§£é”...');
                unlockAudio();
            }

            // ç­‰å¾…éŸ³é¢‘åŠ è½½å®Œæˆåå†æ’­æ”¾
            if (audioLoadStatus.dingdong && dingdong.readyState >= 3) {
                dingdong.currentTime = 0;
                const playPromise = dingdong.play();
                if (playPromise !== undefined) {
                    playPromise.catch(err => console.error('æ’­æ”¾å®å’šéŸ³å¤±è´¥:', err));
                }
            } else {
                console.warn('å®å’šéŸ³æœªåŠ è½½å®Œæˆï¼Œç­‰å¾…åŠ è½½...');
                dingdong.addEventListener('canplaythrough', function playWhenReady() {
                    dingdong.removeEventListener('canplaythrough', playWhenReady);
                    dingdong.currentTime = 0;
                    const playPromise = dingdong.play();
                    if (playPromise !== undefined) {
                        playPromise.catch(err => console.error('æ’­æ”¾å®å’šéŸ³å¤±è´¥:', err));
                    }
                }, { once: true });
            }
        }

        function playAnnounce(dir) { // æ’­æ”¾æŠ¥ç«™éŸ³
            if (!audioUnlocked) {
                console.warn('éŸ³é¢‘æœªè§£é”ï¼Œå°è¯•è§£é”...');
                unlockAudio();
            }

            const audio = dir === 'left' ? announceLeft : announceRight;
            const statusKey = dir === 'left' ? 'announceLeft' : 'announceRight';

            if (audioLoadStatus[statusKey] && audio.readyState >= 3) {
                audio.currentTime = 0;
                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    playPromise.catch(err => console.error('æ’­æ”¾æŠ¥ç«™éŸ³å¤±è´¥:', err));
                }
            } else {
                console.warn('æŠ¥ç«™éŸ³æœªåŠ è½½å®Œæˆï¼Œç­‰å¾…åŠ è½½...');
                audio.addEventListener('canplaythrough', function playWhenReady() {
                    audio.removeEventListener('canplaythrough', playWhenReady);
                    audio.currentTime = 0;
                    const playPromise = audio.play();
                    if (playPromise !== undefined) {
                        playPromise.catch(err => console.error('æ’­æ”¾æŠ¥ç«™éŸ³å¤±è´¥:', err));
                    }
                }, { once: true });
            }
        }

        function playDoorOpen() { // æ’­æ”¾å¼€é—¨éŸ³
            if (!audioUnlocked) {
                console.warn('éŸ³é¢‘æœªè§£é”ï¼Œå°è¯•è§£é”...');
                unlockAudio();
            }

            if (audioLoadStatus.doorOpen && doorOpenSound.readyState >= 3) {
                doorOpenSound.currentTime = 0;
                const playPromise = doorOpenSound.play();
                if (playPromise !== undefined) {
                    playPromise.catch(err => console.error('æ’­æ”¾å¼€é—¨éŸ³å¤±è´¥:', err));
                }
            } else {
                console.warn('å¼€é—¨éŸ³æœªåŠ è½½å®Œæˆï¼Œç­‰å¾…åŠ è½½...');
                doorOpenSound.addEventListener('canplaythrough', function playWhenReady() {
                    doorOpenSound.removeEventListener('canplaythrough', playWhenReady);
                    doorOpenSound.currentTime = 0;
                    const playPromise = doorOpenSound.play();
                    if (playPromise !== undefined) {
                        playPromise.catch(err => console.error('æ’­æ”¾å¼€é—¨éŸ³å¤±è´¥:', err));
                    }
                }, { once: true });
            }
        }

        function playDoorClose() { // æ’­æ”¾å…³é—¨éŸ³
            if (!audioUnlocked) {
                console.warn('éŸ³é¢‘æœªè§£é”ï¼Œå°è¯•è§£é”...');
                unlockAudio();
            }

            if (audioLoadStatus.doorClose && doorCloseSound.readyState >= 3) {
                doorCloseSound.currentTime = 0;
                const playPromise = doorCloseSound.play();
                if (playPromise !== undefined) {
                    playPromise.catch(err => console.error('æ’­æ”¾å…³é—¨éŸ³å¤±è´¥:', err));
                }
            } else {
                console.warn('å…³é—¨éŸ³æœªåŠ è½½å®Œæˆï¼Œç­‰å¾…åŠ è½½...');
                doorCloseSound.addEventListener('canplaythrough', function playWhenReady() {
                    doorCloseSound.removeEventListener('canplaythrough', playWhenReady);
                    doorCloseSound.currentTime = 0;
                    const playPromise = doorCloseSound.play();
                    if (playPromise !== undefined) {
                        playPromise.catch(err => console.error('æ’­æ”¾å…³é—¨éŸ³å¤±è´¥:', err));
                    }
                }, { once: true });
            }
        }

        // ==================== çº¿è·¯å›¾ ====================
        const stations = [ // ç«™ç‚¹æ•°ç»„
            { name: 'å¸‚æ°‘ä¸­å¿ƒ' },
            { name: 'é‡‘èè¡—' },
            { name: 'æ–‡åŒ–ä¸­å¿ƒ', current: true }, // å½“å‰ç«™ç‚¹
            { name: 'ä½“è‚²ä¸­å¿ƒ' },
            { name: 'å•†ä¸šè¡—' }
        ];

        function initRouteLine() { // åˆå§‹åŒ–çº¿è·¯å›¾
            const container = document.getElementById('routeStrip'); // è·å–å®¹å™¨
            container.innerHTML = ''; // æ¸…ç©ºå†…å®¹
            
            stations.forEach((station, index) => { // éå†ç«™ç‚¹
                const stationEl = document.createElement('div'); // åˆ›å»ºç«™ç‚¹å…ƒç´ 
                stationEl.className = 'station'; // æ·»åŠ ç±»å
                if (station.current) stationEl.classList.add('current'); // å½“å‰ç«™é«˜äº®
                
                const dot = document.createElement('div'); // åˆ›å»ºåœ†ç‚¹
                dot.className = 'station-dot';
                stationEl.appendChild(dot); // æ·»åŠ åˆ°ç«™ç‚¹
                
                const name = document.createElement('div'); // åˆ›å»ºç«™å
                name.className = 'station-name';
                name.textContent = station.name;
                stationEl.appendChild(name); // æ·»åŠ åˆ°ç«™ç‚¹
                
                container.appendChild(stationEl); // æ·»åŠ åˆ°å®¹å™¨
                
                if (index < stations.length - 1) { // ä¸æ˜¯æœ€åä¸€ä¸ªç«™ç‚¹
                    const line = document.createElement('div'); // åˆ›å»ºè¿çº¿
                    line.className = 'station-line';
                    container.appendChild(line); // æ·»åŠ è¿çº¿
                }
            });
        }


        // ==================== æ¸¸æˆçŠ¶æ€ ====================
        let state = 'ready'; // æ¸¸æˆçŠ¶æ€
        let direction = 'left'; // å½“å‰æ–¹å‘
        let autoMode = false; // æ˜¯å¦è‡ªåŠ¨æ¨¡å¼
        let autoTimer = null; // è‡ªåŠ¨æ¨¡å¼å®šæ—¶å™¨

        const train = document.getElementById('train'); // åˆ—è½¦å…ƒç´ 
        const statusText = document.getElementById('statusText'); // çŠ¶æ€æ–‡æœ¬
        const speedLines = document.getElementById('speedLines'); // é€Ÿåº¦çº¿å®¹å™¨

        const psdDoors = [ // å±è”½é—¨å…ƒç´ æ•°ç»„
            document.getElementById('pDoor1L'),
            document.getElementById('pDoor1R'),
            document.getElementById('pDoor2L'),
            document.getElementById('pDoor2R')
        ];

        const trainDoors = [ // åˆ—è½¦é—¨å…ƒç´ æ•°ç»„
            document.getElementById('tDoor1L'),
            document.getElementById('tDoor1R'),
            document.getElementById('tDoor2L'),
            document.getElementById('tDoor2R')
        ];

        const btnLeft = document.getElementById('btnLeft'); // å‘å·¦æŒ‰é’®
        const btnRight = document.getElementById('btnRight'); // å‘å³æŒ‰é’®
        const btnArrive = document.getElementById('btnArrive'); // è¿›ç«™æŒ‰é’®
        const btnOpen = document.getElementById('btnOpen'); // å¼€é—¨æŒ‰é’®
        const btnClose = document.getElementById('btnClose'); // å…³é—¨æŒ‰é’®
        const btnDepart = document.getElementById('btnDepart'); // ç¦»ç«™æŒ‰é’®
        const btnAuto = document.getElementById('btnAuto'); // è‡ªåŠ¨æŒ‰é’®

        function setStatus(text, type) { // è®¾ç½®çŠ¶æ€æ–‡æœ¬
            statusText.textContent = text; // è®¾ç½®å†…å®¹
            statusText.className = 'status-indicator' + (type ? ' ' + type : ''); // è®¾ç½®æ ·å¼
        }

        function updateButtons() { // æ›´æ–°æŒ‰é’®çŠ¶æ€
            btnArrive.disabled = state !== 'ready' && state !== 'departed'; // è¿›ç«™æŒ‰é’®
            btnOpen.disabled = state !== 'arrived'; // å¼€é—¨æŒ‰é’®
            btnClose.disabled = state !== 'open'; // å…³é—¨æŒ‰é’®
            btnDepart.disabled = state !== 'arrived' && state !== 'closing'; // ç¦»ç«™æŒ‰é’®
            btnLeft.disabled = state !== 'ready' && state !== 'departed'; // å‘å·¦æŒ‰é’®
            btnRight.disabled = state !== 'ready' && state !== 'departed'; // å‘å³æŒ‰é’®
        }

        function createSpeedLines() { // åˆ›å»ºé€Ÿåº¦çº¿
            speedLines.innerHTML = '';
            for (let i = 0; i < 8; i++) { // ç”Ÿæˆ8æ¡é€Ÿåº¦çº¿
                const line = document.createElement('div');
                line.className = 'speed-line';
                line.style.top = (20 + Math.random() * 60) + '%'; // éšæœºå‚ç›´ä½ç½®
                line.style.width = (40 + Math.random() * 80) + 'px'; // éšæœºå®½åº¦
                line.style.animationDelay = Math.random() * 0.15 + 's'; // éšæœºå»¶è¿Ÿ
                line.style.animationDuration = (0.2 + Math.random() * 0.1) + 's'; // éšæœºåŠ¨ç”»æ—¶é•¿
                speedLines.appendChild(line);
            }
        }

        function createTunnelLights() { // åˆ›å»ºéš§é“ç¯å…‰
            const container = document.getElementById('tunnelLights');
            for (let i = 0; i < 8; i++) { // ç”Ÿæˆ8ä¸ªç¯å…‰
                const light = document.createElement('div');
                light.className = 'tunnel-light';
                light.style.left = (15 + i * 10) + '%'; // æ¨ªå‘åˆ†å¸ƒ
                light.style.top = (25 + Math.random() * 15) + '%'; // éšæœºçºµå‘ä½ç½®
                container.appendChild(light);
            }
        }


        // ==================== æ–¹å‘åˆ‡æ¢ ====================
        function setDirection(dir) { // è®¾ç½®è¡Œé©¶æ–¹å‘
            if (state !== 'ready' && state !== 'departed') return; // ä»…åœ¨å‡†å¤‡æˆ–ç¦»ç«™åå¯åˆ‡æ¢
            
            direction = dir; // è®¾ç½®æ–¹å‘
            
            // é‡ç½®åˆ—è½¦ä½ç½®å’Œç±»
            train.classList.remove('dir-left', 'dir-right', 'arrived', 'departed'); // ç§»é™¤æ‰€æœ‰æ–¹å‘å’ŒçŠ¶æ€ç±»
            void train.offsetWidth; // å¼ºåˆ¶é‡ç»˜
            
            if (dir === 'left') { // å‘å·¦
                btnLeft.classList.add('active'); // æ¿€æ´»å·¦æŒ‰é’®
                btnRight.classList.remove('active');
                train.classList.add('dir-left'); // æ·»åŠ å·¦è¡Œé©¶ç±»
            } else { // å‘å³
                btnRight.classList.add('active'); // æ¿€æ´»å³æŒ‰é’®
                btnLeft.classList.remove('active');
                train.classList.add('dir-right'); // æ·»åŠ å³è¡Œé©¶ç±»
            }
        }


        // ==================== æ ¸å¿ƒåŠŸèƒ½ ====================
        function doArrive() { // è¿›ç«™
            if (state !== 'ready' && state !== 'departed') return; // ä»…åœ¨å‡†å¤‡æˆ–ç¦»ç«™åå¯è¿›ç«™
            
            state = 'arriving'; // çŠ¶æ€åˆ‡æ¢ä¸ºè¿›ç«™ä¸­
            setStatus('åˆ—è½¦è¿›ç«™ä¸­...', 'arriving'); // æ˜¾ç¤ºçŠ¶æ€
            updateButtons(); // æ›´æ–°æŒ‰é’®
            
            playDingdong(); // æ’­æ”¾å®å’š
            setTimeout(() => playAnnounce(direction), 800); // å»¶è¿Ÿæ’­æ”¾æŠ¥ç«™éŸ³
            
            createSpeedLines(); // åˆ›å»ºé€Ÿåº¦çº¿
            speedLines.classList.add('active'); // æ˜¾ç¤ºé€Ÿåº¦çº¿
            
            setTimeout(() => {
                train.classList.add('arrived'); // æ·»åŠ åˆ°ç«™ç±»ï¼Œè§¦å‘åŠ¨ç”»
            }, 50);
            
            setTimeout(() => {
                speedLines.classList.remove('active'); // éšè—é€Ÿåº¦çº¿
                state = 'arrived'; // çŠ¶æ€åˆ‡æ¢ä¸ºåˆ°ç«™
                setStatus('åˆ—è½¦å·²åˆ°è¾¾', 'boarding'); // æ˜¾ç¤ºçŠ¶æ€
                updateButtons(); // æ›´æ–°æŒ‰é’®
                if (autoMode) autoTimer = setTimeout(doOpen, 1500); // è‡ªåŠ¨æ¨¡å¼ä¸‹å»¶è¿Ÿå¼€é—¨
            }, 3000);
        }

        function doOpen() { // å¼€é—¨
            if (state !== 'arrived') return; // ä»…åˆ°ç«™åå¯å¼€é—¨
            
            state = 'open'; // çŠ¶æ€åˆ‡æ¢ä¸ºå¼€é—¨
            setStatus('å¼€é—¨ä¸­...', 'boarding'); // æ˜¾ç¤ºçŠ¶æ€
            updateButtons(); // æ›´æ–°æŒ‰é’®
            
            playDoorOpen(); // æ’­æ”¾å¼€é—¨éŸ³
            
            psdDoors.forEach(door => { if (door) door.classList.add('open'); }); // å±è”½é—¨å¼€é—¨
            trainDoors.forEach(door => { if (door) door.classList.add('open'); }); // åˆ—è½¦é—¨å¼€é—¨
            
            setTimeout(() => {
                setStatus('ä¸Šä¸‹å®¢ä¸­...', 'boarding'); // æ˜¾ç¤ºä¸Šä¸‹å®¢
                if (autoMode) autoTimer = setTimeout(doClose, 4000); // è‡ªåŠ¨æ¨¡å¼ä¸‹å»¶è¿Ÿå…³é—¨
            }, 1000);
        }

        function doClose() { // å…³é—¨
            if (state !== 'open') return; // ä»…å¼€é—¨åå¯å…³é—¨
            
            state = 'closing'; // çŠ¶æ€åˆ‡æ¢ä¸ºå…³é—¨ä¸­
            setStatus('å…³é—¨ä¸­...', 'departing'); // æ˜¾ç¤ºçŠ¶æ€
            updateButtons(); // æ›´æ–°æŒ‰é’®
            
            playDoorClose(); // æ’­æ”¾å…³é—¨éŸ³
            
            psdDoors.forEach(door => { if (door) door.classList.remove('open'); }); // å±è”½é—¨å…³é—¨
            trainDoors.forEach(door => { if (door) door.classList.remove('open'); }); // åˆ—è½¦é—¨å…³é—¨
            
            setTimeout(() => {
                state = 'arrived'; // çŠ¶æ€åˆ‡æ¢ä¸ºåˆ°ç«™
                setStatus('è½¦é—¨å·²å…³é—­', 'departing'); // æ˜¾ç¤ºçŠ¶æ€
                updateButtons(); // æ›´æ–°æŒ‰é’®
                if (autoMode) autoTimer = setTimeout(doDepart, 1200); // è‡ªåŠ¨æ¨¡å¼ä¸‹å»¶è¿Ÿç¦»ç«™
            }, 1000);
        }

        function doDepart() { // ç¦»ç«™
            if (state !== 'arrived' && state !== 'closing') return; // ä»…åˆ°ç«™æˆ–å…³é—¨åå¯ç¦»ç«™
            
            state = 'departing'; // çŠ¶æ€åˆ‡æ¢ä¸ºç¦»ç«™
            setStatus('åˆ—è½¦ç¦»ç«™...', 'departing'); // æ˜¾ç¤ºçŠ¶æ€
            updateButtons(); // æ›´æ–°æŒ‰é’®
            
            createSpeedLines(); // åˆ›å»ºé€Ÿåº¦çº¿
            speedLines.classList.add('active'); // æ˜¾ç¤ºé€Ÿåº¦çº¿
            
            // ä»å½“å‰åœé ä½ç½®å¼€å§‹é©¶å‡º
            // ä¿è¯ç¦»ç«™åŠ¨ç”»èµ·å§‹æ—¶æœ‰translateX(-50%)
            train.classList.remove('arrived'); // ç§»é™¤åˆ°ç«™ç±»
            // å¼ºåˆ¶ä¿ç•™transform: translateX(-50%)
            train.style.transform = 'translateZ(-200px) translateX(-50%)';
            train.classList.add('departed'); // æ·»åŠ ç¦»ç«™ç±»
            
            setTimeout(() => {
                speedLines.classList.remove('active'); // éšè—é€Ÿåº¦çº¿
                state = 'departed'; // çŠ¶æ€åˆ‡æ¢ä¸ºç¦»ç«™å®Œæˆ
                setStatus('åˆ—è½¦å·²ç¦»ç«™'); // æ˜¾ç¤ºçŠ¶æ€
                updateButtons(); // æ›´æ–°æŒ‰é’®

                // ç«‹å³é—ªç°åˆ°å¦ä¸€ä¾§å±å¹•å¤–ï¼Œé¿å…è§†è§‰ç©¿è¶Š
                train.classList.remove('departed'); // ç§»é™¤ç¦»ç«™ç±»
                train.style.transition = 'none'; // å…³é—­è¿‡æ¸¡åŠ¨ç”»
                void train.offsetWidth; // å¼ºåˆ¶é‡ç»˜
                if (direction === 'left') {
                    train.classList.remove('dir-left', 'dir-right');
                    train.classList.add('dir-left');
                } else {
                    train.classList.remove('dir-left', 'dir-right');
                    train.classList.add('dir-right');
                }
                void train.offsetWidth; // å†æ¬¡å¼ºåˆ¶é‡ç»˜
                train.style.transition = '';

                if (autoMode) autoTimer = setTimeout(doArrive, 2500); // è‡ªåŠ¨æ¨¡å¼ä¸‹å»¶è¿Ÿè¿›ç«™
            }, 3000);
        }

        function toggleAuto() { // åˆ‡æ¢è‡ªåŠ¨æ¨¡å¼
            autoMode = !autoMode; // å–å
            
            if (autoMode) { // å¼€å¯è‡ªåŠ¨
                btnAuto.classList.add('active'); // æ¿€æ´»æŒ‰é’®
                btnAuto.textContent = 'åœæ­¢å¾ªç¯'; // æŒ‰é’®æ–‡å­—
                
                if (state === 'ready' || state === 'departed') {
                    doArrive(); // è¿›ç«™
                } else if (state === 'arrived') {
                    doOpen(); // å¼€é—¨
                } else if (state === 'open') {
                    doClose(); // å…³é—¨
                }
            } else { // å…³é—­è‡ªåŠ¨
                btnAuto.classList.remove('active'); // å–æ¶ˆæ¿€æ´»
                btnAuto.textContent = 'è‡ªåŠ¨å¾ªç¯'; // æŒ‰é’®æ–‡å­—
                if (autoTimer) {
                    clearTimeout(autoTimer); // æ¸…é™¤å®šæ—¶å™¨
                    autoTimer = null;
                }
            }
        }

        // ==================== äº‹ä»¶ç»‘å®š ====================
        // åœ¨æ‰€æœ‰æŒ‰é’®ç‚¹å‡»æ—¶å…ˆè§£é”éŸ³é¢‘
        btnLeft.addEventListener('click', () => { unlockAudio(); setDirection('left'); }); // å·¦æŒ‰é’®ç‚¹å‡»
        btnRight.addEventListener('click', () => { unlockAudio(); setDirection('right'); }); // å³æŒ‰é’®ç‚¹å‡»
        btnArrive.addEventListener('click', () => { unlockAudio(); doArrive(); }); // è¿›ç«™æŒ‰é’®ç‚¹å‡»
        btnOpen.addEventListener('click', () => { unlockAudio(); doOpen(); }); // å¼€é—¨æŒ‰é’®ç‚¹å‡»
        btnClose.addEventListener('click', () => { unlockAudio(); doClose(); }); // å…³é—¨æŒ‰é’®ç‚¹å‡»
        btnDepart.addEventListener('click', () => { unlockAudio(); doDepart(); }); // ç¦»ç«™æŒ‰é’®ç‚¹å‡»
        btnAuto.addEventListener('click', () => { unlockAudio(); toggleAuto(); }); // è‡ªåŠ¨æŒ‰é’®ç‚¹å‡»

        // ==================== åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', () => { // é¡µé¢åŠ è½½å®Œæˆ
            createTunnelLights(); // åˆ›å»ºéš§é“ç¯å…‰
            initRouteLine(); // åˆå§‹åŒ–çº¿è·¯å›¾
            updateButtons(); // æ›´æ–°æŒ‰é’®
            setDirection('left'); // é»˜è®¤å‘å·¦è¡Œé©¶

            // ç§»åŠ¨ç«¯é¦–æ¬¡è§¦æ‘¸è§£é”éŸ³é¢‘
            document.body.addEventListener('touchstart', unlockAudio, { once: true });
            document.body.addEventListener('click', unlockAudio, { once: true });
        });

        document.addEventListener('touchmove', e => e.preventDefault(), { passive: false }); // ç¦æ­¢é¡µé¢æ»‘åŠ¨
    </script>
</body>
</html>